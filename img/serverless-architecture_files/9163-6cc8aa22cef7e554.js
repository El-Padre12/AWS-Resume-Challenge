"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9163],{32559:function(e,t,n){n.d(t,{GO:function(){return S},Gm:function(){return Q},Kn:function(){return U},O3:function(){return m},Qs:function(){return T},RN:function(){return E},VR:function(){return h},YJ:function(){return p},Yc:function(){return b},cd:function(){return u},dY:function(){return w},iR:function(){return x},nL:function(){return i},oS:function(){return y}});var r,u,i,a=n(28803),o=n(5362),l=n(27218),s=n(30947),c=n(13262),d=n(77930),f=n(21520),v=n.n(f),g=n(7653),_=n(95586);let y=30,p=1e4;(u||(u={})).Student="student",(r=i||(i={})).Study="study",r.Career="career",r.Research="research";let h=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid;return(0,o.WE)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[c.bZ,{orgUUID:t}],staleTime:3e5,enabled:!!t})},m=e=>{let{enabled:t=!0,limit:n,offset:r,starred:u,creatorFilter:i}=e,{activeOrganization:a}=(0,l.t)(),s=(0,_.U)(),d=null==a?void 0:a.uuid,f=new URLSearchParams;return f.append("include_harmony_projects","true"),void 0!==n&&f.append("limit",n.toString()),void 0!==r&&f.append("offset",r.toString()),void 0!==u&&f.append("starred",u.toString()),void 0!==i&&f.append("creator_filter",i.toString()),(0,o.WE)("/api/organizations/".concat(d,"/projects?").concat(f.toString()),{queryKey:[c.gi,{orgUuid:d},{limit:n,offset:r,starred:u,creatorFilter:i}],enabled:!!(t&&a&&s),select:e=>{let t=e.length===n;return Object.assign(e.filter(e=>!e.archived_at),{hasMore:t})}})},E=()=>{let{activeOrganization:e}=(0,l.t)(),t=(0,o.OJ)();return(0,g.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},C=(e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),r=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...r]},S=()=>{let e=E(),t=(0,a.Pe)();return(0,g.useCallback)(async()=>{let[n,r]=await Promise.all([e(),t({limit:a.bf})]);return C(n,r)},[t,e])},b=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid;return(0,o.WE)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[c.$T,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof s.Hx&&404===e.statusCode}})},T=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return(0,o.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[c.gi,{orgUuid:t}]})}})},w=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid,r=Q();return(0,o.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{r(e)},queryKey:[c.$T,{orgUuid:n,projectUuid:e}]})},x=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid;return(0,o.WE)("/api/organizations/".concat(n,"/projects/").concat(e,"/conversations"),{queryKey:[c.lx,{orgUuid:n,projectUuid:e}],enabled:!!t,staleTime:0,select:e=>v()(e,e=>new Date(e.updated_at)).reverse()})},U=()=>{var e,t;let n=m({enabled:!0,creatorFilter:"is_creator",limit:p}),r=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:r}},Q=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[c.$T,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[c.gi,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.lx,{orgUuid:t,projectUuid:e}]})}}},95586:function(e,t,n){n.d(t,{H:function(){return l},U:function(){return o}});var r=n(27218),u=n(48410),i=n(98649),a=n(58183);let o=()=>{let e=(0,r.ZJ)(),t=(0,r.ue)(),n=(0,r.Cf)(),{selectedTier:o,shouldOverrideFeatureAccess:l,isTierSelectorEnabled:s}=(0,u.i)(),c=(0,a.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0,d=s&&l&&o?o===i.kQ.PRO||o===i.kQ.MAX||o===i.kQ.ENTERPRISE:e||t||n;return c||d},l=()=>{let e=(0,r.ZJ)(),t=(0,r.ue)(),n=(0,r.Cf)(),{selectedTier:o,shouldOverrideFeatureAccess:l,isTierSelectorEnabled:s}=(0,u.i)(),c=(0,a.useDynamicConfig)("claude_ai_projects_limits");if(s&&l&&o?o!==i.kQ.PRO&&o!==i.kQ.MAX&&o!==i.kQ.ENTERPRISE:!e&&!t&&!n)return c.get("max_free_projects",0)}},28803:function(e,t,n){n.d(t,{V0:function(){return C},bf:function(){return S},OD:function(){return N},m:function(){return T},$Y:function(){return R},$H:function(){return Q},j1:function(){return k},f7:function(){return O},Pe:function(){return w},j7:function(){return B},Rq:function(){return m},Cy:function(){return I},cE:function(){return E},CJ:function(){return P},_C:function(){return x},QR:function(){return b},y6:function(){return q},cc:function(){return U},gm:function(){return D},Ke:function(){return z},T$:function(){return W},fc:function(){return H},W:function(){return L},PD:function(){return K},Gk:function(){return G},gK:function(){return V},Ls:function(){return j},jl:function(){return A}});var r=n(3053),u=n(5362),i=n(27218),a=n(1812),o=n(98731),l=n(13262),s=n(7653);function c(e){let t=JSON.stringify(e);return(0,s.useMemo)(()=>e,[t])}var d=n(51432),f=n(45144),v=n(77930),g=n(50803),_=n(87590),y=n.n(_),p=n(81695),h=n(1146);let m=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.t)(),r=null==n?void 0:n.uuid,[u,a]=(0,s.useReducer)(e=>e+1,0),o=c([l.I8,{orgUUID:r},{uuid:e}]),d=(0,s.useMemo)(()=>t.getQueryData(o),[t,o,e,u]);return(0,s.useEffect)(()=>t.getQueryCache().subscribe(e=>{"updated"===e.type&&"success"===e.action.type&&(0,g._x)({queryKey:o},e.query)&&a()}),[t,a,o]),{data:d}},E=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.t)(),r=null==n?void 0:n.uuid,u=c([l.I8,{orgUUID:r},{uuid:e}]);return t.getQueryData(u)},C=30,S=1e4,b=e=>{let{limit:t,offset:n,enabled:r=!0,starred:a}=e,{activeOrganization:o}=(0,i.t)(),s=null==o?void 0:o.uuid,c=new URLSearchParams;void 0!==t&&c.append("limit",t.toString()),void 0!==n&&c.append("offset",n.toString()),void 0!==a&&c.append("starred",a.toString());let d=c.toString();return d=d?"?".concat(d):"",(0,u.WE)("/api/organizations/".concat(null!=s?s:"","/chat_conversations").concat(d),{queryKey:[l.tv,{orgUUID:s},{limit:t,offset:n,starred:a}],staleTime:3e5,enabled:!!s&&r})},T=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid;return(0,u.WE)("/api/organizations/".concat(t,"/chat_conversations/count_all"),{queryKey:[l.Dn,{orgUUID:t}],staleTime:3e5,enabled:!!t})},w=()=>{let{activeOrganization:e}=(0,i.t)(),t=(0,u.OJ)();return(0,s.useCallback)(async n=>{let{limit:r,offset:u}=n,i=new URLSearchParams;void 0!==r&&i.append("limit",r.toString()),void 0!==u&&i.append("offset",u.toString());let a=i.toString();return a=a?"?".concat(a):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(a))).json()},[null==e?void 0:e.uuid,t])},x=function(e){let{suppressError:t,enabled:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enabled:!0},{activeOrganization:r}=(0,i.t)(),a=null==r?void 0:r.uuid,o=(0,s.useRef)([]),c=(0,v.useQueryClient)(),d="/api/organizations/".concat(null!=a?a:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),f=(0,u.WE)(d,{queryKey:[l.I8,{orgUUID:a},{uuid:e}],staleTime:3e5,enabled:!!a&&!!e&&n,meta:{noToast:t}},t=>(c.invalidateQueries({queryKey:[l.Gj,{orgUUID:a,conversationUUID:e}]}),(0,h.fX)(t))),g=(0,s.useMemo)(()=>{if(!f.data)return o.current=[],o.current;let e=(0,h.kX)(f.data);if(e.length!==o.current.length||e.some((e,t)=>{var n;return e.uuid!==(null===(n=o.current[t])||void 0===n?void 0:n.uuid)}))return o.current=e,o.current;for(let t=0;t<e.length;t++)y()(e[t],o.current[t])||(o.current[t]=e[t]);return o.current},[f.data]);return{...f,currentPath:g}},U=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.t)(),r=null==n?void 0:n.uuid;return(0,s.useCallback)(()=>{t.invalidateQueries({queryKey:[l.I8,{orgUUID:r},{uuid:e}]})},[t,r,e])},Q=(e,t)=>{let{mutateAsync:n}=R(),r=(0,p.useRouter)(),u=t||(0,d.H)();return(0,s.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},i={uuid:u,name:"",model:t.model};t.createMode&&(i.create_mode=t.createMode),t.projectUuid&&(i.project_uuid=t.projectUuid),n(i).then(()=>{let n="/chat/".concat(u).concat(t.controlsOpen?"?controls=1":"");r[e](n)}).catch(e=>{(0,f.Tb)(e)})},[n,r,e,u])},R=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid,n=(0,v.useQueryClient)(),r=e=>[l.I8,{orgUUID:t},{uuid:e}];return(0,u.uC)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,onSuccess:e=>{n.setQueryData(r(e.uuid),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map}))}})},k=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid,n=(0,v.useQueryClient)();return(0,u.Ne)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let r=t.findIndex(e=>e.uuid===n);if(!(r>-1))return t;{let e=[...t];return e.splice(r,1),e}},{enabled:!!t,queryKey:[l.tv,{orgUUID:t}],onSuccess:async(e,r)=>{let{uuid:u,projectUuid:i}=r;await n.invalidateQueries({queryKey:[l.I8,{orgUUID:t},{uuid:u}]}),i&&await n.invalidateQueries({queryKey:[l.lx,{orgUuid:t,projectUuid:i}]}),await F(n,t)}})},O=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,r=(0,v.useQueryClient)();return(0,u.uC)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await F(r,n),e&&e(t)}})},D=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid,n=null==e?void 0:e.capabilities.includes("raven");return(0,u.WE)("/api/organizations/".concat(t,"/shares"),{queryKey:[l.PB,{orgUUID:t}],enabled:!!t&&n,staleTime:3e5})},I=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid;return(0,u.WE)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e,queryKey:[l.Gj,{orgUUID:n,conversationUUID:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:r}=e;return{shareable:n,disabled_reason:r,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,h.Dk)(e))}:null}})},P=e=>{let{activeOrganization:t,account:n}=(0,i.t)(),r=null==t?void 0:t.uuid,a=n&&r?"/api/organizations/".concat(r,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,u.WE)(a,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[l.ld,{orgUUID:r,snapshotUUID:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,h.Dk)(e))}))},K=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,r=(0,v.useQueryClient)();return(0,u.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{r.invalidateQueries({queryKey:[l.Gj,{orgUUID:n,conversationUUID:e}]}),r.invalidateQueries({queryKey:[l.PB,{orgUUID:n}]}),r.invalidateQueries({queryKey:[l.VH,{orgUUID:n}]})}})},j=(e,t)=>{let{activeOrganization:n}=(0,i.t)(),r=null==n?void 0:n.uuid,a=(0,v.useQueryClient)();return(0,u.uC)("/api/organizations/".concat(r,"/share/").concat(t),"DELETE",{enabled:!!r&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{a.invalidateQueries({queryKey:[l.Gj,{orgUUID:r,conversationUUID:e}]}),a.invalidateQueries({queryKey:[l.PB,{orgUUID:r}]}),a.invalidateQueries({queryKey:[l.VH,{orgUUID:r}]})}})},q=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid;return(0,u.WE)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e&&!!n,staleTime:0,queryKey:[l.qB,{artifactVersionUUID:e}]})},z=function(e,t,n){var o,s,c;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:f}=(0,r.z$)(),g=null!==(s=null===(o=(0,a.T)())||void 0===o?void 0:o.preview_feature_uses_artifacts)&&void 0!==s&&s,{activeOrganization:_}=(0,i.t)(),y=null==_?void 0:_.uuid,p=(0,v.useQueryClient)(),h=[l.I8,{orgUUID:y},{uuid:e}];return(0,u.uC)("/api/organizations/".concat(null!=y?y:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!==(c=t.uuid)&&void 0!==c?c:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!y,meta:{errorMessage:"We could not save your feedback. Please try again later."},...d,onSuccess(){for(var r,u,i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];f({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:g,conversationHasArtifacts:n,type:null===(r=t.chat_feedback)||void 0===r?void 0:r.type}),p.invalidateQueries({queryKey:h}),null===(u=d.onSuccess)||void 0===u||u.call(d,...a)}})},M=()=>{let e=(0,v.useQueryClient)(),{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid;return(0,s.useCallback)((t,r)=>{t&&(e.setQueryData([l.I8,{orgUUID:n},{uuid:t}],e=>e&&{...e,...r}),e.setQueriesData({queryKey:[l.tv,{orgUUID:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...r})))},[n,e])},L=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.t)(),r=null==n?void 0:n.uuid,a=M();return(0,u.uC)("/api/organizations/".concat(r,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var u;let{name:i}=n,o=t.getQueryData([l.I8,{orgUUID:r},{uuid:e}]);return a(e,{name:i}),{oldTitle:null!==(u=null==o?void 0:o.name)&&void 0!==u?u:""}},onError(t,n,r){r&&a(e,{name:r.oldTitle})}})},B=e=>{let t=M(),{activeOrganization:n}=(0,i.t)();return(0,u.uC)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:r}=n;t(e,{name:null!=r?r:""})},meta:{noToast:!0}})};function N(e){var t,n;let r=(0,o.K)(e);return r+" "+e.attachments.map(e=>e.extracted_content).join(" ")+" "+((null===(t=e.content)||void 0===t?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null===(n=e.content)||void 0===n?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let V=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid;return(0,u.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},H=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid;return(0,u.uC)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},A=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid;return(0,u.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},W=(e,t)=>{let{activeOrganization:n}=(0,i.t)(),r=(0,v.useQueryClient)(),a=null==n?void 0:n.uuid;return(0,u.Ne)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{F(r,a)},onSettled:()=>{(null==t?void 0:t.refetchOnSettled)&&r.refetchQueries({queryKey:[l.I8,{orgUUID:a},{uuid:e}]})},queryKey:[l.I8,{orgUUID:a},{uuid:e}]})},F=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:[l.tv,{orgUUID:t}]}),e.invalidateQueries({queryKey:[l.Dn,{orgUUID:t}]})])},G=e=>{let{activeOrganization:t}=(0,i.t)(),n=(0,v.useQueryClient)(),r=null==t?void 0:t.uuid;return(0,u.Ne)("/api/organizations/".concat(r,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{F(n,r)},queryKey:[l.I8,{orgUUID:r},{uuid:e}]})}},1146:function(e,t,n){n.d(t,{Dk:function(){return f},Ef:function(){return s},FC:function(){return a},Gg:function(){return c},HX:function(){return _},QC:function(){return l},fX:function(){return g},kX:function(){return p},mj:function(){return h},vv:function(){return y},w$:function(){return d},wZ:function(){return o}});var r=n(45144),u=n(52221),i=n.n(u);let a="new-assistant-message-uuid",o="new-human-message-uuid",l="00000000-0000-4000-8000-000000000000",s=e=>e!==a;function c(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,r.Tb)(e),e}return n}let d=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;for(;n!==l;){var r;let t=c(e.parentByChildUuid,n),u=null===(r=c(e.childrenByParentUuid,t))||void 0===r?void 0:r.indexOf(n);e.selectedChildByUuid.set(t,u),n=t}return{...e,current_leaf_message_uuid:t}},f=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},v=e=>{var t,n,r;let u=new Map,i=new Map,a=new Map,o=new Map,s=new Map;if(0===e.chat_messages.length)return{messageByUuid:i,parentByChildUuid:a,childrenByParentUuid:o,selectedChildByUuid:s};let c=e.chat_messages.map(f);for(let e of c)u.set(e.index,e),i.set(e.uuid,e);for(let e of c){let t=e.parent_message_uuid;if(!t){let r=e.index-1;for(;!t&&r>=0;)t=null===(n=u.get(r))||void 0===n?void 0:n.uuid,r--}t=null!=t?t:l,a.set(e.uuid,t),o.set(t,(null!==(r=o.get(t))&&void 0!==r?r:[]).concat(e.uuid)),s.set(t,0)}if(!(null===(t=o.get(l))||void 0===t?void 0:t[0]))throw Error("No root message found");return{chat_messages:c,messageByUuid:i,parentByChildUuid:a,childrenByParentUuid:o,selectedChildByUuid:s}},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let r=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),u={...e,chat_messages:r},i={...u,...v(u)};return i.current_leaf_message_uuid||d(i),d(i,u.current_leaf_message_uuid)},_=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},y=(e,t)=>{for(let r of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!r.parent_message_uuid)throw Error("Parent UUID required");let t=r.parent_message_uuid;e.messageByUuid.set(r.uuid,r),e.parentByChildUuid.set(r.uuid,t);let u=null!==(n=e.childrenByParentUuid.get(t))&&void 0!==n?n:[];u.push(r.uuid),e.childrenByParentUuid.set(t,u),e.selectedChildByUuid.set(t,u.length-1)}return d(e,t[t.length-1].uuid)},p=(e,t)=>{let n=[],r=null!=t?t:l;for(;e.childrenByParentUuid.has(r);){let t=c(e.childrenByParentUuid,r);if(0===t.length)break;let u=c(e.selectedChildByUuid,r),i=c(e.messageByUuid,t[u]);n.push({...i,parent_message_uuid:r,nOptions:t.length,selectedOption:u}),r=i.uuid}return n};function h(e,t,n){var r;let u=c(e.parentByChildUuid,t.uuid),a=c(e.childrenByParentUuid,u),o=i()((null!==(r=t.selectedOption)&&void 0!==r?r:0)+n,0,a.length-1);e.selectedChildByUuid.set(u,o);let l=p(e,u);return d(e,l[l.length-1].uuid)}},1812:function(e,t,n){n.d(t,{I:function(){return o},T:function(){return a}});var r=n(27573),u=n(7653);let i=(0,u.createContext)(null),a=()=>{let e=(0,u.useContext)(i);return void 0===e?null:e},o=e=>{let{children:t,settings:n}=e;return(0,r.jsx)(i.Provider,{value:n,children:t})}},48410:function(e,t,n){n.d(t,{TierSelectorProvider:function(){return d},i:function(){return c}});var r=n(27573),u=n(6385),i=n(87033),a=n(98649),o=n(7653),l=n(40287);let s=(0,o.createContext)(null),c=()=>{let e=(0,o.useContext)(s);if(!e)throw Error("useTierSelector must be used within a TierSelectorProvider");return e},d=e=>{var t;let{children:n,initialEnabled:c=!1}=e,d=(0,l.f)(),[f,v]=(0,o.useState)(()=>d.get(u.cn.SELECTED_TIER)||null),[g,_]=(0,o.useState)(()=>"true"===d.get(u.cn.SHOULD_OVERRIDE_TOKEN_LIMITS)),[y,p]=(0,o.useState)(()=>"true"===d.get(u.cn.SHOULD_OVERRIDE_FEATURE_ACCESS)),h=null!==(t=(0,i.FL)("internal_tier_selector").value)&&void 0!==t?t:c,m=(0,o.useState)(h)[1],E=(0,o.useCallback)(()=>{let e=[a.kQ.FREE,a.kQ.PRO,a.kQ.ENTERPRISE,a.kQ.MAX],t=Math.floor(Math.random()*e.length);return e[t]},[]),C=(0,o.useCallback)(e=>{if(!h){v(e);return}if(null===e){let e=f||E();d.set(u.cn.SELECTED_TIER,e,{maxAgeSeconds:2592e3})}else d.set(u.cn.SELECTED_TIER,e);v(e)},[f,v,d,E,h]);(0,o.useEffect)(()=>{h?f&&d.set(u.cn.SELECTED_TIER,f):d.delete(u.cn.SELECTED_TIER)},[h,f,d]);let S=(0,o.useCallback)(e=>{if(!h){_(e);return}e?d.set(u.cn.SHOULD_OVERRIDE_TOKEN_LIMITS,"true"):d.delete(u.cn.SHOULD_OVERRIDE_TOKEN_LIMITS),_(e)},[h,d]),b=(0,o.useCallback)(e=>{if(!h){p(e);return}e?d.set(u.cn.SHOULD_OVERRIDE_FEATURE_ACCESS,"true"):d.delete(u.cn.SHOULD_OVERRIDE_FEATURE_ACCESS),p(e)},[h,d]);return(0,o.useEffect)(()=>{h||(d.delete(u.cn.SHOULD_OVERRIDE_TOKEN_LIMITS),d.delete(u.cn.SHOULD_OVERRIDE_FEATURE_ACCESS))},[h,d]),(0,r.jsx)(s.Provider,{value:{selectedTier:f,isTierSelectorEnabled:h,setSelectedTier:C,setIsTierSelectorEnabled:m,shouldOverrideTokenLimits:g,setShouldOverrideTokenLimits:S,shouldOverrideFeatureAccess:y,setShouldOverrideFeatureAccess:b},children:n})}},32737:function(e,t,n){n.d(t,{u:function(){return v}});var r=n(41596),u=n(27573),i=n(9788),a=n(85638),o=n(10607),l=n(68425);function s(){let e=(0,r._)(["\n  px-2\n  py-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-md\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return s=function(){return e},e}function c(){let e=(0,r._)(["\n  max-w-[337px]\n  z-tooltip\n  [*:disabled_&]:hidden\n"]);return c=function(){return e},e}function d(){let e=(0,r._)(["\n  p-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-lg\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return d=function(){return e},e}function f(){let e=(0,r._)(["\n  p-1\n  text-sm\n  font-normal\n  font-styrene\n  leading-tight\n  border-border-300\n  border-0.5\n  rounded-lg\n  shadow-diffused \n  shadow-[hsl(var(--always-black)/4%)]\n  text-text-100\n  bg-bg-100\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return f=function(){return e},e}function v(e){let{children:t,tooltipContent:n,contentStyle:r="default",side:i="top",sideOffset:l,align:s,className:c,delayDuration:d=200,...f}=e,v=y[r];return(0,u.jsx)(a.zt,{delayDuration:d,children:(0,u.jsxs)(a.fC,{...f,children:[(0,u.jsx)(a.xz,{asChild:!0,children:t}),(0,u.jsx)(a.h_,{children:(0,u.jsx)("span",{children:(0,u.jsx)(v,{className:(0,o.Z)(c,!n&&"hidden"),sideOffset:null!=l?l:5,side:i,align:s,children:n})})})]})})}let g=(0,i.q)(a.VY)(s()),_=(0,i.q)(a.VY)(c()),y={default:g,citation:e=>{let{children:t,...n}=e;return(0,u.jsx)(_,{...n,children:(0,u.jsx)(l.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},className:"p-1 text-sm font-normal font-styrene leading-tight text-text-200 bg-bg-100 break-words border-0.5 border-border-300/25 max-h-[300px] shadow-diffused shadow-[hsl(var(--always-black)/4%)] rounded-lg overflow-y-auto",children:t})})},inputMenu:(0,i.q)(a.VY)(d()),sampleImage:(0,i.q)(a.VY)(f())}},98731:function(e,t,n){n.d(t,{K:function(){return r}});let r=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},51432:function(e,t,n){n.d(t,{H:function(){return r}});let r=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()}}]);