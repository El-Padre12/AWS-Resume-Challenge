"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1217],{66605:function(e,t,n){n.d(t,{P9:function(){return m},Vw:function(){return p},aP:function(){return f},cE:function(){return g},fg:function(){return y},us:function(){return v}});var r=n(5362),a=n(27218),i=n(6385),o=n(13262),l=n(10228),u=n(77930),c=n(7653),s=n(19132),d=n(22534);let f=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,i=!!(t&&e.length>0),l=(0,c.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),u=(0,c.useMemo)(()=>({queryKey:e.map(e=>[o.cF,{orgUuid:n,syncSourceUuid:e}]),enabled:i,refetchInterval:e=>!!(e.state.data&&(0,s.sf)(e.state.data))&&5e3,meta:{noToast:!0}}),[i,n,e]);return(0,r.Nl)(l,u)},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,s.sf)(e.data)),y=e=>Math.ceil(f(e).reduce((e,t)=>{var n,r,a;return t.isLoading||!t.data?e:e+(null!==(a=null===(r=t.data)||void 0===r?void 0:null===(n=r.status)||void 0===n?void 0:n.current_size_bytes)&&void 0!==a?a:0)},0)/i.r6),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,a.t)(),i=null==t?void 0:t.uuid,c=null==n?void 0:n.uuid,f=(0,u.useQueryClient)(),p=(0,s.gb)();return(0,r.uC)(()=>"/api/organizations/".concat(c,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,r,a,u,s=arguments.length,d=Array(s),p=0;p<s;p++)d[p]=arguments[p];let[y]=d;f.setQueryData([o.cF,{orgUuid:c,syncSourceUuid:y.uuid}],y),y.type===l.Fg.GDRIVE&&y.config.uri&&(null===(t=y.status)||void 0===t?void 0:t.extra)&&(null===(n=y.status)||void 0===n?void 0:n.current_size_bytes)&&f.setQueryData([o.HI,{accountUUID:i,orgUUID:c,documentId:y.config.uri}],{uri:"drive:///".concat(y.config.uri),title:null===(a=y.status)||void 0===a?void 0:a.extra,size:null===(u=y.status)||void 0===u?void 0:u.current_size_bytes}),null===(r=e.onSuccess)||void 0===r||r.call(e,...d)},onError:function(){for(var t,n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];null===(t=e.onError)||void 0===t||t.call(e,...r);let[i,o]=r;p(i,o),o.sync_source_type===l.Fg.GDRIVE&&(0,d.ZZ)(o.sync_source_config.uri)}})},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,i=(0,u.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,r=arguments.length,a=Array(r),l=0;l<r;l++)a[l]=arguments[l];let[u]=a;i.setQueryData([o.cF,{orgUuid:n,syncSourceUuid:u.uuid}],u),null===(t=e.onSuccess)||void 0===t||t.call(e,...a)}})},v=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid;return(0,r.uC)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},18187:function(e,t,n){n.d(t,{HN:function(){return u},SE:function(){return c},Tx:function(){return s}});var r=n(5362),a=n(27218),i=n(13262),o=n(77930),l=n(32559);let u=(e,t)=>{let{account:n,activeOrganization:u}=(0,a.t)(),c=t===(null==n?void 0:n.uuid),s=null==u?void 0:u.uuid,d=(0,o.useQueryClient)(),f=(0,l.Gm)();return(0,r.uC)(()=>"/api/organizations/".concat(s,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries({queryKey:[i.l3,{projectUuid:e}]}),c&&(f(e),d.invalidateQueries({queryKey:[i.VH,{orgUUID:s}]}),d.invalidateQueries({queryKey:[i.tv,{orgUUID:s}]}),d.invalidateQueries({queryKey:[i.Dn,{orgUUID:s}]}))}})},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,a.t)(),o=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[i.l3,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0})},s=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,r.uC)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.l3,{projectUuid:e}]})},transformVariables:e=>({role:e.role})})}},95899:function(e,t,n){n.d(t,{ER:function(){return f},Kf:function(){return c},Zy:function(){return y},h4:function(){return g},i9:function(){return u},op:function(){return p},pK:function(){return m},tR:function(){return s},u3:function(){return d}});var r=n(5362),a=n(27218),i=n(30947),o=n(13262),l=n(77930);let u="[ANT ONLY] synced_resources.txt";function c(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid,{data:l,...c}=(0,r.WE)("/api/organizations/".concat(i,"/projects/").concat(e,"/docs"),{queryKey:[o.zy,{orgUuid:i,projectUuid:e}],enabled:!!n&&!!e&&t});return{data:null==l?void 0:l.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return t!==u}),unfilteredData:l,...c}}let s=e=>{let{projectUuid:t,docUuid:n}=e,{activeOrganization:l}=(0,a.t)(),u=null==l?void 0:l.uuid;return(0,r.WE)("/api/organizations/".concat(u,"/projects/").concat(t,"/docs/").concat(n),{queryKey:[o.tt,{orgUuid:u,projectUuid:t,docUuid:n}],enabled:!!l,staleTime:0,meta:{noToast:e=>e instanceof i.Hx&&404===e.statusCode}})};function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid,u=(0,l.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(i,"/projects/").concat(e,"/docs"),"POST",{enabled:!!e,onSuccess:function(){for(var n,r=arguments.length,a=Array(r),l=0;l<r;l++)a[l]=arguments[l];u.invalidateQueries({queryKey:[o.zy,{orgUuid:i,projectUuid:e}]}),u.invalidateQueries({queryKey:[o.VH,{orgUUID:i}]}),u.invalidateQueries({queryKey:[o.rt,{orgUuid:i,projectUuid:e}]}),null===(n=t.onSuccess)||void 0===n||n.call(t,...a)},onError:function(){for(var e,n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];null===(e=t.onError)||void 0===e||e.call(t,...r)}})}function f(e){let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,r.Ne)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[o.zy,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,r)=>{i.invalidateQueries({queryKey:[o.tt,{orgUuid:n,projectUuid:e,docUuid:r.docUuid}]}),i.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]}),i.invalidateQueries({queryKey:[o.rt,{orgUuid:n,projectUuid:e}]})},onError:()=>{i.invalidateQueries({queryKey:[o.zy,{orgUuid:n,projectUuid:e}]})}})}let p=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[o.zy,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,r)=>{for(let t of r.doc_uuids)i.invalidateQueries({queryKey:[o.tt,{orgUuid:n,projectUuid:e,docUuid:t}]});i.invalidateQueries({queryKey:[o.zy,{orgUuid:n,projectUuid:e}]}),i.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]}),i.invalidateQueries({queryKey:[o.rt,{orgUuid:n,projectUuid:e}]})}})};function y(e){let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,r.Ne)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"PUT",(e,t)=>t?t.map(t=>t.uuid===e.docUuid?{...t,...e}:t):t,{queryKey:[o.zy,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,r)=>{i.invalidateQueries({queryKey:[o.tt,{orgUuid:n,projectUuid:e,docUuid:r.docUuid}]}),i.invalidateQueries({queryKey:[o.zy,{orgUuid:n,projectUuid:e}]}),i.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]})}})}function g(e){let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[o.jb,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:()=>{i.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]}),i.invalidateQueries({queryKey:[o.rt,{orgUuid:n,projectUuid:e}]})},onError:()=>{i.invalidateQueries({queryKey:[o.jb,{orgUuid:n,projectUuid:e}]})}})}function m(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(i,"/projects/").concat(e,"/files"),{queryKey:[o.jb,{orgUuid:i,projectUuid:e}],enabled:!!n&&!!e&&t})}},92676:function(e,t,n){n.d(t,{AQ:function(){return y},IP:function(){return d},gr:function(){return u},l2:function(){return c},yg:function(){return f},zB:function(){return s}});var r=n(5362),a=n(27218),i=n(13262),o=n(77930),l=n(19132);let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid,o=p(),u=(0,l.gb)();return(0,r.uC)(()=>"/api/organizations/".concat(i,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];o(e),null===(n=t.onSuccess)||void 0===n||n.call(t,...a)},onError:function(){for(var e,n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];null===(e=t.onError)||void 0===e||e.call(t,...r);let[i,o]=r;u(i,o)}})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid,o=p();return(0,r.uC)(()=>"/api/organizations/".concat(i,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];o(e),null===(n=t.onSuccess)||void 0===n||n.call(t,...a)}})},s=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,o=p();return(0,r.Ne)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[i.AI,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},d=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,o=p();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[i.AI,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},f=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:u}=(0,a.t)(),c=null==u?void 0:u.uuid,s=(0,o.useQueryClient)(),d=!!(u&&e&&n),{data:f,isLoading:p}=(0,r.WE)("/api/organizations/".concat(c,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[i.AI,{orgUuid:c,projectUuid:e,calculateSize:t}],enabled:d,refetchInterval:e=>{var t;return(null===(t=e.state.data)||void 0===t?void 0:t.some(l.sf))?5e3:3e5},structuralSharing:(t,n)=>{let r=void 0!==t&&t.some(l.sf),a=void 0!==n&&n.some(l.sf);return r&&!a&&s.invalidateQueries({queryKey:[i.rt,{orgUuid:c,projectUuid:e}]}),n}});return{data:f,isLoading:!!d&&p}},p=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[i.AI,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[i.Xg,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[i.rt,{orgUuid:t,projectUuid:e}]})}},y=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(l.sf))}},42814:function(e,t,n){n.d(t,{GB:function(){return u},HK:function(){return d},KM:function(){return s},fq:function(){return c},h9:function(){return l}});var r=n(5362),a=n(27218),i=n(13262),o=n(77930);let l=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid;return(0,r.WE)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[i.it,{orgUUID:t}]})},u=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[i.it,{orgUUID:t}]})}})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,a.t)(),l=null==n?void 0:n.uuid,u=(0,o.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(l,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{u.invalidateQueries({queryKey:[i.it,{orgUUID:l}]})},enabled:!t})},s=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.it,{orgUUID:n}]})}})},d=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid;return(0,r.uC)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},19132:function(e,t,n){n.d(t,{BZ:function(){return _},Bl:function(){return F},LZ:function(){return C},M1:function(){return h},QD:function(){return k},_3:function(){return j},gb:function(){return I},hJ:function(){return m},j5:function(){return z},sf:function(){return S},tc:function(){return v},te:function(){return P},xm:function(){return x},xn:function(){return w}});var r=n(19170),a=n(5362),i=n(27218),o=n(27895),l=n(30947),u=n(13262),c=n(87033),s=n(10228),d=n(88755),f=n(77930),p=n(81695),y=n(7653),g=n(68571);let m=e=>e.type===s.Fg.GITHUB?{sync_source_type:s.Fg.GITHUB,sync_source_config:e.config}:e.type===s.Fg.GDRIVE?{sync_source_type:s.Fg.GDRIVE,sync_source_config:e.config}:null,v=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid;return(0,a.WE)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[u.FU,{orgUUID:t}],enabled:!!e})},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,r=(0,f.useQueryClient)();return(0,a.Ne)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:r}=e;t||(t=[]);let a=t.map(e=>e.type===n?{...e,enabled:r}:e);return a.some(e=>e.type===n)?a:[...t,{type:n,enabled:r}]},{queryKey:[u.FU,{orgUUID:n}],enabled:!!t,onSuccess:async function(){for(var t,a=arguments.length,i=Array(a),o=0;o<a;o++)i[o]=arguments[o];await r.invalidateQueries({queryKey:[u.FU,{orgUUID:n}]}),await (null===(t=e.onSuccess)||void 0===t?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,r=(0,f.useQueryClient)(),{value:o}=(0,c.FL)("kingfisher_enabled"),{value:l}=(0,c.FL)("apps_use_bananagrams");return(0,a.Ne)("/api/organizations/".concat(n,"/sync/settings/config"),"POST",(e,t)=>{let{type:n,config:r}=e;return t||(t=[]),t.map(e=>e.type===n?{...e,config:{...e.config,...r}}:e)},{queryKey:[u.FU,{orgUUID:n}],enabled:!!(t&&o&&l),onSuccess:async function(){for(var t,a=arguments.length,i=Array(a),o=0;o<a;o++)i[o]=arguments[o];await r.invalidateQueries({queryKey:[u.FU,{orgUUID:n}]}),await (null===(t=e.onSuccess)||void 0===t?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},b=(e,t)=>{let n=new URLSearchParams(Array.from(t.entries()));n.delete(e);let r=n.toString()?"?".concat(n.toString()):"",a=window.location.pathname+r;window.history.replaceState({...window.history.state,as:a,url:a},"",a)},_=e=>{let{callerIdentifier:t,successParam:n,handleOpen:r}=e,a=(0,p.useSearchParams)(),i=(0,y.useRef)(!1);(0,y.useEffect)(()=>{!a.has(n)||i.current||t&&t!==a.get(n)||(i.current=!0,b(n,a),r())},[a,t,r,n])},C=e=>{let{pathname:t,searchParams:n,queryString:r,isClaudeApp:a}=e,i="".concat(t,"?").concat(r),o=n.get("origin");if(o)i=o;else if(a){let e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,n=t.startsWith("/project/")&&e.test(t.slice(9)),a=t.startsWith("/chat/")&&e.test(t.slice(6));i="claude://claude.ai".concat(n||a||"/new"===t?t:"/new","?").concat(r)}return i},E=e=>[s.co.CREATED,s.co.PENDING,s.co.UPDATING].includes(e),S=e=>E(e.status.state),x=e=>[s.co.FAILED,s.co.UPDATE_FAILED].includes(e.status.state),U=e=>{if(e instanceof l.Hx)return e instanceof l.Hx&&"access_denied"===e.errorCode},I=()=>{let{addError:e}=(0,o.e)(),t=(0,f.useQueryClient)();return(n,r)=>{U(n)&&(e("Please try again. You may need to reconnect with your ".concat(s.hP[r.sync_source_type]," account.")),u.Su.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[u.cF]}))}},A={[s.Fg.GCAL]:"enabled_foccacia",[s.Fg.GMAIL]:"enabled_sourdough"},j=e=>{let t=e===s.Fg.GCAL||e===s.Fg.GMAIL?"pumpernickel_enabled":"cinnabon_enabled",{value:n}=(0,c.FL)(t);return!g.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&n},T=e=>{let t=(0,i.Cf)(),{data:n}=v(),r=!!(Array.isArray(n)&&n.find(t=>t.type===e&&t.enabled));return!t||r},P=e=>{let t=T(e);return!!(j(e)&&t)},D=e=>"sfdc"===e?"salesforce":e,k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,i.t)(),r=null==n?void 0:n.uuid,o=(0,p.useRouter)(),l=(0,p.usePathname)(),u=(0,p.useSearchParams)(),{callerIdentifier:c,handleAuthSuccess:s}=t,g=P(e),m=(0,f.useQueryClient)(),v=(0,d.Q)(),{data:h,isFetched:w}=(0,a.WE)("/api/organizations/".concat(r,"/sync/").concat(D(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:r}],enabled:!!(n&&g)}),b=(0,y.useRef)(!1),{mutate:E}=(0,a.uC)("/api/organizations/".concat(r,"/sync/").concat(D(e),"/auth/start"),"POST",{enabled:!!(n&&g),onSuccess:e=>{o.push(e.redirect_url)}});_({callerIdentifier:c,successParam:"".concat(e,"_success"),handleOpen:()=>null==s?void 0:s(!0)});let{mutate:S}=(0,a.uC)("/api/organizations/".concat(r,"/sync/").concat(D(e),"/auth"),"DELETE",{enabled:!!(n&&g),onSuccess:()=>{m.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:r}]})}});return{isAuthenticated:g&&!!(null==h?void 0:h.is_authenticated),startAuth:()=>{if(!b.current&&g){let t=C({pathname:l,searchParams:u,queryString:"".concat(e,"_success=").concat(c),isClaudeApp:v});if(v){window.open("/settings/integrations?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(t));return}b.current=!0,E({pre_auth_state:{origin:t},redirect_uri:new URL("/connect/".concat(D(e),"/callback"),window.location.origin).toString()})}},disconnect:S,isFetched:w}},z=(e,t)=>{var n,r;let a=P(e),{account:o}=(0,i.t)(),l=A[e];return l?a&&(t?!!(null==t?void 0:null===(n=t.conversationSettings)||void 0===n?void 0:n[l]):!!(null==o?void 0:null===(r=o.settings)||void 0===r?void 0:r[l])):a},F=()=>{let{account:e}=(0,i.t)(),{mutate:t}=(0,r.Ck)();return{toggleIntegrationEnabled:(n,r)=>{if(!e)return;let a=A[n];a&&t({...e.settings,[a]:r})}}}},91217:function(e,t,n){n.d(t,{x:function(){return x},r:function(){return S}});var r=n(27573),a=n(26525),i=n(5161),o=n(64295),l=n(6766),u=n(5362),c=n(7653),s=n(66605),d=n(95899),f=n(92676),p=n(40051),y=n(7680),g=n(18701),m=n(40030),v=n(10690),h=n(18013),w=n(70773);let b={type:"doc",content:[{type:"paragraph",content:[]}]},_=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),C=e=>{let t=(0,c.useCallback)(t=>{if(!(!e||_(document.activeElement))&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;t.preventDefault(),null===(n=e.getEditor())||void 0===n||n.chain().insertContent(t.key).focus().run()}},[e]);(0,c.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},E=c.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,isFocused:!1,setIsFocused:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),S=()=>c.useContext(E),x=e=>{var t,n,_,S,x,U,I;let{onSend:A,willRedirectOnSubmit:j,onCreate:T,onStopSampling:P,customFileUploadHandler:D}=e,k=(0,c.useRef)(null),z="conversation"in e,{children:F,projectUuid:M,namespace:L}=e,R=z?e.conversation:void 0,q=(0,c.useCallback)(()=>{z&&P&&P()},[P,z]);C(k.current);let{tipTapEditorState:K,setTipTapEditorText:Q,setTipTapEditorJSON:N,isTipTapEditorStateUnsafe:O,attachments:H,setAttachments:W,files:Z,setFiles:G,syncSourceUuids:B,setSyncSourceUuids:Y,clear:V}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r="".concat(n?"".concat(n,":"):"").concat(e),[a,i,l]=(0,h.R)("".concat(r,":attachment"),[]),[u,s,d]=(0,h.R)("".concat(r,":files"),[]),[f,p,y]=(0,h.R)("".concat(r,":syncSourceUuids"),[]),[g,m,v]=(0,h.R)("".concat(r,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:b),_=(0,c.useCallback)(()=>!!g.__ant_unsafe,[g]),C=(0,c.useCallback)((e,t)=>{let n=(0,w.G)(e),r={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:n}]}]};return n.length>0&&t&&(r.__ant_unsafe=!0),m(r),n},[m]);return{attachments:a,setAttachments:i,files:u,setFiles:s,syncSourceUuids:f,setSyncSourceUuids:p,tipTapEditorState:g,setTipTapEditorJSON:(0,c.useCallback)(e=>{let t=(0,o.A5)(e);return t.length>0&&_()&&(e.__ant_unsafe=!0),m(e),t},[m,_]),setTipTapEditorText:C,isTipTapEditorStateUnsafe:_,clear:(0,c.useCallback)(()=>{v(),l(),d(),y()},[l,v,d,y])}}(null!==(n=null==R?void 0:R.id)&&void 0!==n?n:void 0===M?"new-conversation":"".concat(M,":conversation"),"",L),J=K?(0,o.A5)(K):"",[X,$]=c.useState(J),ee=(0,c.useCallback)(e=>{$(N(e))},[N,$]),et=(0,c.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Q(e,n);if($(r),!0===t){var a;null===(a=k.current)||void 0===a||a.setContent(r)}},[Q]),en=(0,s.aP)(B),er=(0,s.Vw)(en),ea=(0,u.F9)(en),ei=H.length+Z.length+B.length>=a.Qe,[eo,el]=c.useState(!1),[eu,ec]=c.useState(),{stickyModelPreference:es}=(0,l.M)(),ed=null!==(x=null!==(S=null!==(_=null==R?void 0:R.model)&&void 0!==_?_:eu)&&void 0!==S?S:es)&&void 0!==x?x:void 0,[ef,ep]=c.useState(),ey=(0,c.useCallback)(e=>{ep(t=>({...t,...e}))},[]),[eg,em]=c.useState(M),ev=(0,f.AQ)(eg),[eh,ew]=c.useState(!1),[eb,e_]=c.useState(),[eC,eE]=c.useState(!1),[eS,ex]=c.useState(!1),[eU,eI]=c.useState(!1),{storedStyle:eA,defaultStyle:ej}=(0,p.O)(),[eT,eP]=c.useState(),[eD,ek]=c.useState(!0),[ez,eF]=c.useState();(0,c.useEffect)(()=>{let e=null!=eA?eA:ej;!eT&&e&&eP(e)},[eA,ej,eT]),(0,c.useEffect)(()=>{M&&eg!==M&&em(M)},[M,eg]);let eM="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,c.useEffect)(()=>{e_(void 0),ew(!1)},[null==R?void 0:R.id]),(0,c.useEffect)(()=>{null==eM||eM(eT)},[eT,eM]);let{projectHasHarmony:eL}=(0,g.Y)(eg),{openedFiles:eR,projectDocs:eq,projectUuid:eK}=(0,m.b)(),{getInstance:eQ}=(0,y.s)(),{mutateAsync:eN}=(0,d.u3)(eK),{mutateAsync:eO}=(0,d.Zy)(eK),eH=(0,c.useCallback)(async()=>{if(k.current&&(""!==X.trim()||0!==H.length||0!==Z.length||0!==B.length)){j&&e_([...Z]),V(),$(""),j?k.current.setEditable(!1):k.current.setContent(""),ew(!0),eL&&await (null===v.ec||void 0===v.ec?void 0:(0,v.ec)(eR,eK,eq,eN,eO,eQ));try{z&&A?(await A({prompt:X,attachments:H,files:Z,syncSources:ea,personalized_style:eT}),ew(!1),e_(void 0)):await T({prompt:X,attachments:H,files:Z,syncSources:ea,model:ed,project_uuid:eg,personalized_style:eT,include_conversation_preferences:eD,...ef})}catch(t){var e;et(X),null===(e=k.current)||void 0===e||e.setContent(X),W(H),G(Z),Y(B),k.current.setEditable(!0),ew(!1),e_(void 0)}}},[ef,H,V,eN,Z,eQ,eK,eL,eD,z,ed,T,A,eR,eT,eq,eg,X,W,G,et,Y,B,ea,eO,j]),eW=(0,c.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&z){ew(!0);try{A&&(await A({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:eT}),ew(!1))}catch(e){ew(!1)}}},[z,A,eT]),eZ=(0,c.useCallback)(async e=>{if(ec(e),z){ew(!0);try{var t;await T({prompt:X,attachments:H,files:Z,syncSources:ea,model:e,project_uuid:eg,create_mode:null==R?void 0:null===(t=R.conversationSettings)||void 0===t?void 0:t.create_mode,...ef})}finally{ew(!1)}}},[ef,H,Z,z,eg,X,T,ea,null==R?void 0:null===(t=R.conversationSettings)||void 0===t?void 0:t.create_mode]),eG=(0,c.useCallback)(()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.focus()},[k]),[eB,eY]=c.useState(!1),eV=(0,i.eh)(),[eJ,eX,e$,e0,e1,e2,e3,e5]=(0,a.kS)({syncSourceCount:B.length,attachments:H,setAttachments:W,numExistingConversationAttachments:null!==(U=null==R?void 0:R.attachmentsSoFar)&&void 0!==U?U:0,files:Z,setFiles:G,numExistingConversationFiles:null!==(I=null==R?void 0:R.files.length)&&void 0!==I?I:0,detectSameAttachment:()=>!1,selectedModel:ed,blobFileUploadsEnabled:eV,customFileUploadHandler:D}),e7=H.length+Z.length,e8=B.length,e6=eJ||eS||eU,e9=e7>0||e8>0||e6,e4=(0,c.useMemo)(()=>{var t;return{prompt:X,tipTapEditorState:K,attachments:H,files:e.willRedirectOnSubmit&&eh?null!=eb?eb:[]:Z,syncSourceUuids:B,isAtMaxNumUploads:ei,isUploadingDriveSync:eS,isUploadingGithubSync:eU,model:ed,projectUuid:eg,isChatSyncing:er,personalizedStyle:eT,isProjectSyncing:ev,isNewConversation:void 0===R||0===R.messagesSoFar,isProjectLocked:void 0!==M||void 0!==R,isSending:eh,setPrompt:et,setTipTapEditorState:ee,setAttachments:W,setFiles:G,setSyncSourceUuids:Y,setModel:eZ,setProjectUuid:em,sendMessage:eH,sendTransparentMessage:eW,stopSampling:q,conversation:R,focusInput:eG,isFocused:eC,setIsFocused:eE,promptInputRef:k,willRedirectOnSubmit:null!==(t=e.willRedirectOnSubmit)&&void 0!==t&&t,hasBlockingWarning:eB,setHasBlockingWarning:eY,setPersonalizedStyle:eP,setIsUploadingDriveSync:ex,setIsUploadingGithubSync:eI,includeProfilePreferences:eD,setIncludeProfilePreferences:ek,pendingConversationSettings:ef,setPendingConversationSettings:ey,isUploadingFile:eJ,setIsUploadingFile:eX,validateMaxUploadLimit:e$,onDrop:e0,onPasteFiles:e1,handleUpload:e2,uploadInputProps:e5,hasAttachments:e9,isModelSelectorOpen:eo,setIsModelSelectorOpen:el,isPromptUnsafe:O,currentCompassTask:ez,setCurrentCompassTask:eF}},[H,R,Z,eG,M,eB,eD,ei,er,eC,ev,eh,eS,eU,ed,eT,eg,X,e.willRedirectOnSubmit,eH,eW,W,G,eZ,ef,ey,et,Y,ee,q,B,K,eb,eJ,eX,e$,e0,e1,e2,e5,e9,eo,el,O,ez,eF]);return(0,r.jsx)(E.Provider,{value:e4,children:F})}},47082:function(e,t,n){n.d(t,{M:function(){return d},Y:function(){return f}});var r=n(27573),a=n(35919),i=n.n(a),o=n(7653);function l(e,t){switch(t.type){case"OPEN_COMPASS_STATUS":return{...e,selectedItem:{type:"compass",data:t.data}};case"SELECT_ATTACHMENT":return{...e,selectedItem:{type:"attachment",attachment:t.attachment}};case"SELECT_ARTIFACT":return{...e,selectedItem:{type:"artifact",id:t.id,versionUUID:t.versionUUID}};case"SELECT_DOC":return{...e,selectedItem:{type:"doc",id:t.id}};case"SELECT_SYNCED_DIRECTORY":return{...e,selectedItem:{type:"syncedDirectory",id:t.id}};case"CLEAR_SELECTED":return{...e,selectedItem:null,activeMessageUUID:void 0};case"SET_ACTIVE_MESSAGE_UUID":return{...e,activeMessageUUID:t.uuid};case"UPDATE_ARTIFACTS":return{...e,artifacts:t.artifacts};case"UPDATE_ATTACHMENTS":return{...e,attachments:t.attachments};case"UPDATE_FILES":return{...e,files:t.files};case"UPDATE_SYNC_SOURCES":return{...e,syncSources:t.syncSources};case"UPDATE_DOC_UPDATES":return{...e,docUpdates:t.updates};case"UPDATE_FILE_EDITS":return{...e,fileEdits:t.edits};default:return e}}let u={selectedItem:null,artifacts:{},attachments:[],files:[],syncSources:[],docUpdates:[],fileEdits:new Map,activeMessageUUID:void 0,conversationUUID:void 0},c={chatResourceState:u,dispatchChatResource:i()},s=(0,o.createContext)(c);function d(e){let{children:t,conversationUUID:n}=e,[a,i]=(0,o.useReducer)(l,{...u,conversationUUID:n});return(0,r.jsx)(s.Provider,{value:{chatResourceState:a,dispatchChatResource:i},children:t})}function f(){return(0,o.useContext)(s)}},40051:function(e,t,n){n.d(t,{O:function(){return l}});var r=n(18013),a=n(87033),i=n(42814);let o=(e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t,l=()=>{let{value:e}=(0,a.FL)("concise_mode_enabled"),{data:t,isLoading:n}=(0,i.h9)(),l=(null==t?void 0:t.defaultStyles)||[],u=[...l,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[c,s,d]=(0,r.R)("claude_personalized_style",null);if(n||!(null==u?void 0:u.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:s,clearStoredStyle:d,conciseModeEnabled:e};let f=l.length?l.find(e=>!0===e.isDefault)||l[0]:null;if(e&&(f=l.find(e=>"Concise"===e.key)||f),!c)return{personalizedStyleOptions:u,defaultStyle:f,storedStyle:c,setStoredStyle:s,clearStoredStyle:d,conciseModeEnabled:e};let p=u.find(e=>o(e,c.styleKey)),y=Date.now()-new Date(c.timestamp).getTime()>432e5;return{personalizedStyleOptions:u,storedStyle:p&&!y?p:null,defaultStyle:f,setStoredStyle:s,clearStoredStyle:d,conciseModeEnabled:e}}},22534:function(e,t,n){n.d(t,{F7:function(){return o},MU:function(){return i},ZZ:function(){return l}});let r="recentDriveDocs";function a(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function i(e){localStorage.setItem(r,JSON.stringify(e))}function o(){let e=localStorage.getItem(r);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(a))return t}return[]}function l(e){let t=o();i(t=t.filter(t=>t.uri!==e))}},7680:function(e,t,n){n.d(t,{r:function(){return v},s:function(){return h}});var r=n(27573),a=n(3053),i=n(80762),o=n(28346),l=n(24558),u=n.n(l),c=n(35919),s=n.n(c),d=n(7653),f=n(47082),p=n(40030);let y=(0,d.createContext)(null),g={getInstance:()=>void 0,setBaseContent:s(),flagForDeletion:s(),getCurrentContent:()=>void 0,hasUnsavedChanges:()=>!1,registerEditor:s(),unregisterEditor:s(),setMergeState:()=>s(),subscribeToMergeStateChanges:()=>s(),acceptAllChanges:s(),rejectAllChanges:s(),deactivateChangesMode:s(),activeEditors:[],changesMode:!1},m=(e,t)=>{var n,r;let a=null===(r=(0,o.Sk)(e.state))||void 0===r?void 0:null===(n=r.chunks)||void 0===n?void 0:n[0];return!!a&&("accept"===t?o.bN:o.A)(e,a.fromB)};function v(e){let{children:t}=e,{track:n}=(0,a.z$)(),{openedFiles:o}=(0,p.b)(),{dispatchChatResource:l}=(0,f.Y)(),c=(0,d.useRef)(new Map),s=(0,d.useRef)(new Set),g=(0,d.useCallback)((e,t)=>{c.current.set(e,{view:t})},[]),v=(0,d.useCallback)(e=>{c.current.delete(e)},[]),h=(0,d.useCallback)((e,t)=>{let n=c.current.get(e);if(!n){i.v("Attempted to update unknown editor: ".concat(e));return}c.current.set(e,{...n,...t})},[]),w=(0,d.useCallback)((e,t)=>h(e,{baseContent:t}),[h]),b=(0,d.useCallback)(e=>h(e,{filePendingDeletion:!0}),[h]),_=(0,d.useCallback)((e,t)=>{h(e,{mergeState:t}),s.current.forEach(n=>n(e,t))},[h]),C=(0,d.useCallback)(e=>(s.current.add(e),()=>{s.current.delete(e)}),[]),E=(0,d.useCallback)(e=>c.current.get(e),[]),[S,x]=(0,d.useState)([]),[U,I]=(0,d.useState)(!1),A=(0,d.useCallback)(()=>{l({type:"UPDATE_FILE_EDITS",edits:new Map}),I(!1)},[l]);(0,d.useEffect)(()=>{S.length&&I(!0)},[S]),(0,d.useEffect)(()=>(x(o.filter(e=>{var t;let n=E(e);return!!n&&(null===(t=n.mergeState)||void 0===t?void 0:t.isActive)&&!!n.view})),C((e,t)=>{x(n=>{var r;let a=n.includes(e),i=t.isActive&&!!(null===(r=E(e))||void 0===r?void 0:r.view);return a===i?n:i?[...n,e]:n.filter(t=>t!==e)})})),[o,C,E,U]);let j=(0,d.useCallback)(()=>{S.forEach(e=>{var t;let n=null===(t=E(e))||void 0===t?void 0:t.view;if(n)for(;m(n,"accept"););}),n({event_key:"harmony.suggestion.accepted"})},[S,n,E]),T=(0,d.useCallback)(()=>{S.forEach(e=>{var t;let r=null===(t=E(e))||void 0===t?void 0:t.view;if(r){for(;m(r,"reject"););_(e,{isActive:!1}),n({event_key:"harmony.suggestion.rejected"})}})},[S,n,E,_]),P=(0,d.useCallback)(e=>{var t,n;return null===(n=E(e))||void 0===n?void 0:null===(t=n.view)||void 0===t?void 0:t.state.doc.toString()},[E]),D=(0,d.useCallback)(e=>{var t;let n=P(e);return u()(n)&&n!==(null===(t=E(e))||void 0===t?void 0:t.baseContent)},[P,E]),k=(0,d.useMemo)(()=>({getInstance:E,setBaseContent:w,flagForDeletion:b,getCurrentContent:P,hasUnsavedChanges:D,registerEditor:g,unregisterEditor:v,setMergeState:_,subscribeToMergeStateChanges:C,acceptAllChanges:j,rejectAllChanges:T,deactivateChangesMode:A,activeEditors:S,changesMode:U}),[E,w,b,P,D,g,v,_,C,j,T,A,S,U]);return(0,r.jsx)(y.Provider,{value:k,children:t})}function h(){return(0,d.useContext)(y)||g}},71844:function(e,t,n){n.d(t,{KA:function(){return c},Nc:function(){return u},YB:function(){return l},b8:function(){return i},h4:function(){return o}});var r=n(39160),a=n.n(r);function i(e,t){return a()(e,t)}function o(e){let t=[],n=0;for(let[r,a]of e)0!==r&&t.push({op:r,pos:n,text:a}),-1!==r&&(n+=a.length);return t}function l(e){if(!Array.isArray(e))throw Error("Input must be an array");e.forEach((e,t)=>{if(!("object"==typeof e&&null!==e&&"op"in e&&"number"==typeof e.op))throw Error("Invalid change object at index ".concat(t));if(1!==e.op&&-1!==e.op)throw Error("Invalid 'op' value at index ".concat(t));if("number"!=typeof e.pos||!Number.isInteger(e.pos))throw Error("Invalid 'pos' value at index ".concat(t));if("string"!=typeof e.text)throw Error("Invalid 'text' value at index ".concat(t))})}function u(e,t){return function(e,t){let n=e,r=0;for(let e of t){let t=e.pos+r;1===e.op?(n=n.slice(0,t)+e.text+n.slice(t),r+=e.text.length):-1===e.op&&(n=n.slice(0,t)+n.slice(t+e.text.length),r-=e.text.length)}return n}(e,t.map(e=>({op:-e.op,pos:e.pos,text:e.text})).reverse())}function c(e){for(let[t]of e)if(0!==t)return!1;return!0}},28096:function(e,t,n){function r(e){var t;return(null===(t=e.mergeState)||void 0===t?void 0:t.isActive)?e.mergeState.diffSource:e.view.state.doc.toString()}function a(e){return r(e)!==e.baseContent}n.d(t,{li:function(){return r},oI:function(){return a}}),n(71844)},44506:function(e,t,n){n.d(t,{G:function(){return r}});async function r(e){let{createHash:t}=await Promise.all([n.e(2044),n.e(1919)]).then(n.t.bind(n,76736,23));return t("sha256").update(e.trim()).digest("hex").slice(0,6)}},18701:function(e,t,n){n.d(t,{Y:function(){return u}});var r=n(27218),a=n(87033),i=n(58183),o=n(18187),l=n(32559);let u=e=>{var t;let{account:n}=(0,r.t)(),{value:u}=(0,a.FL)("force_harmony"),{data:c,isLoading:s}=(0,l.Yc)(e),{data:d,isLoading:f}=(0,o.SE)(e||""),p=null!==(t=null==d?void 0:d.some(e=>e.account.uuid===(null==n?void 0:n.uuid)&&"user"===e.role))&&void 0!==t&&t,y="showDirectoryPicker"in window&&"FileSystemHandle"in window,g=(0,i.useDynamicConfig)("harmony");return{userHasHarmony:y&&((null==n?void 0:n.settings.preview_feature_uses_harmony)||u)&&g.get("harmonize",!1),projectHasHarmony:!s&&!f&&p&&!!(null==c?void 0:c.is_harmony_project),config:g}}},40030:function(e,t,n){n.d(t,{C:function(){return _},b:function(){return C}});var r=n(27573),a=n(7653),i=n(35919),o=n.n(i);let l=(0,a.createContext)(null),u={openedFiles:[],projectDocs:[],files:[],setFiles:o(),projectUuid:"",syncedDirectories:[],setSyncedDirectories:o()};function c(e){let{children:t,onLoad:n}=e;return(0,a.useEffect)(n,[n]),(0,r.jsx)(l.Provider,{value:u,children:t})}var s=n(80762),d=n(14784),f=n(87590),p=n.n(f),y=n(95899),g=n(85017),m=n(10690),v=n(52902);let h=[];function w(e){let{children:t,onLoad:n,projectUuid:i}=e,{isLoading:o,unfilteredData:u=h}=(0,y.Kf)(i),[c,f]=(0,a.useState)([]),[w,b]=(0,a.useState)([]),_=(0,a.useMemo)(()=>[...(function(e,t){let n=new Map,r=t.filter(v.IQ).map(e=>e.uri);if(!r.length)return n;for(let t of r){let r=new Set;for(let n of e){if(!(0,v.Wx)(n.file_name))continue;let{projectUuid:e,directoryUuid:a}=(0,v.Xp)(n.file_name),i=(0,v.Xp)(t);e===i.projectUuid&&a===i.directoryUuid&&r.add(n.file_name)}n.set(t,r)}return n})(u,c).values()].flatMap(e=>[...e]),[u,c]);(0,a.useEffect)(()=>{(0,g.Zz)(i).then(b).catch(e=>s.v("Harmony: Error initializing synced directories from IndexedDB",e))},[i]);let{mutateAsync:C}=(0,y.u3)(i),{mutateAsync:E}=(0,y.Zy)(i),{mutateAsync:S}=(0,y.ER)(i),x=(0,a.useCallback)(()=>{(0,m.tt)(i,o,c,u,C,E,S).then(e=>{e&&(p()(c,e.updatedFiles)||(f(e.updatedFiles),s.f("Harmony: Resynced ".concat(e.updatedFiles.filter(v.zE).length," files in ").concat(e.updatedFiles.filter(v.IQ).length," directories")),n()))}).catch(e=>s.v("Harmony: Error during resync:",e))},[i,o,c,u,C,E,S,n]),U=(0,a.useRef)(!1);(0,a.useEffect)(()=>{!i||o||U.current||(U.current=!0,x())},[x,i,o]),(0,d.Y)(x,3e4,{autoInvoke:!0});let I=(0,a.useMemo)(()=>({projectUuid:i,openedFiles:_,projectDocs:u,files:c,setFiles:f,syncedDirectories:w,setSyncedDirectories:b}),[i,_,u,c,w,b]);return(0,r.jsx)(l.Provider,{value:I,children:t})}var b=n(18701);function _(e){let{children:t,onLoad:n,projectUuid:a}=e,{userHasHarmony:i}=(0,b.Y)(a);return i?(0,r.jsx)(w,{onLoad:n,projectUuid:a,children:t}):(0,r.jsx)(c,{onLoad:n,children:t})}function C(){return(0,a.useContext)(l)||u}},85017:function(e,t,n){n.d(t,{U4:function(){return f},Zz:function(){return s},sN:function(){return d},y3:function(){return p}});var r=n(80762),a=n(52902);let i="directories",o="projectUuid",l=null;async function u(){return l||new Promise((e,t)=>{let n=indexedDB.open("harmony",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{(l=n.result).onerror=e=>{r.v("Database error:",e)},l.onclose=()=>{l=null},e(l)},n.onupgradeneeded=e=>{e.target.result.createObjectStore(i,{keyPath:"uuid"}).createIndex(o,"projectUuid",{unique:!1})}})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readonly";if(!l)throw Error("Database not initialized");return l.transaction(i,e)}async function s(e){await u();let t=c("readonly").objectStore(i).index(o);return new Promise((n,r)=>{let i=t.getAll(e);i.onerror=()=>r(i.error),i.onsuccess=()=>{n(i.result.map(e=>({...e,uri:(0,a.cT)(e)})))}})}async function d(e){await u();let t=c("readonly").objectStore(i);return new Promise((n,r)=>{let i=t.get(e);i.onerror=()=>r(i.error),i.onsuccess=()=>{if(i.result){let e=i.result;n({...e,uri:(0,a.cT)(e)})}else n(null)}})}async function f(e){return await u(),new Promise((t,n)=>{let r=c("readwrite").objectStore(i).put(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}async function p(e){return await u(),new Promise((t,n)=>{let r=c("readwrite").objectStore(i).delete(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}},10690:function(e,t,n){n.d(t,{Jl:function(){return p},wC:function(){return b},bE:function(){return f},lz:function(){return _},xF:function(){return g},cM:function(){return w},tt:function(){return C},ec:function(){return y}});var r=n(80762),a=n(87590),i=n.n(a),o=n(95899),l=n(71844),u=n(28096),c=n(44506),s=n(85017),d=n(52902);async function f(e){let t=await (0,s.Zz)(e);return await (0,d.C7)(t)}async function p(e,t){return(await (0,d.pJ)(e,t)).text}async function y(e,t,n,a,i,o){let c=await (0,s.Zz)(t),f=Array.from(new Set([...e])).map(async e=>{if((0,d.Wx)(e))try{let t=o(e),s=t?(0,u.li)(t):void 0,d=t?t.baseContent:void 0;if(void 0===d||void 0===s){let t=await p(c,e);if(!s){if(null===t){r.v(Error("File content not found for ".concat(e)));return}return await m(n,a,i,e,t,[])}return await m(n,a,i,e,s,(0,l.b8)(t||"",s))}let f=(0,l.b8)(d,s);return await m(n,a,i,e,s,f)}catch(t){r.v("Error processing file ".concat(e,":"),t)}});await Promise.all(f)}async function g(e,t,n,r,a){let i=await p(e,a);if(null===i)throw Error("File content not found for ".concat(a));if(new TextEncoder().encode(i).length>102400)throw Error("File ".concat(a," is too large and will degrade the experience. Pass a specific view_range when using the view tool for this file."));return await m(t,n,r,a,i)}async function m(e,t,n,r,a,i){let o=e.find(e=>e.file_name===r);if(o&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.match(/<content>([\s\S]*)<\/content>/),r=n&&n[1]?n[1].trim():e;if(t){let t=e.match(/<changes>(.*?)<\/changes>/);if(t&&t[1]){let e=JSON.parse(t[1]);(0,l.YB)(e),r=(0,l.Nc)(r,e)}}return r}(o.content)===a)return o;let u=await v(a,i);return o?await n({docUuid:o.uuid,content:u}):await t({file_name:r,content:u})}async function v(e,t){let n=await (0,c.G)(e),r=void 0!==t&&!(0,l.KA)(t);return"\n<metadata>\n<file_hash>".concat(n,"</file_hash>\n<file_state>\n  ").concat(r&&void 0!==t?"\n  <status>includes_unsaved_changes</status>\n  <message>This content includes modifications since it was last synchronized. You can and should continue to suggest changes using write or replace operations. Your suggestions will be applied to the latest version of the file. THIS IS THE MOST UP TO DATE VERSION OF THE FILE.</message>\n  <changes>".concat(JSON.stringify((0,l.h4)(t)),"</changes>\n"):"<status>synced</status>","\n</file_state>\n</metadata>\n<content>").concat(e,"</content>\n").trim()}async function h(e,t,n,a,i){if(0===e.length){let e=t.find(e=>e.file_name===o.i9);e&&await i({docUuid:e.uuid});return}let l=JSON.stringify(e.map(e=>e.uri),null,2).split("\n"),u=l.slice(0,50).join("\n"),c=l.length-50,s="<synced_resources>\n".concat(u,"\n").concat(c>0?"\n... plus ".concat(c," additional files."):"","\n</synced_resources>"),d=t.filter(e=>e.file_name===o.i9);if(d.length>0){let[e,...n]=d;if(n.length>0&&r.f("Harmony: Cleaning up ".concat(n.length," extra project docs")),await Promise.all(n.map(e=>w(t,e.file_name,i))),e.content===s){r.f("Harmony: Project doc already up to date",e.uuid);return}await a({docUuid:e.uuid,content:s}),r.f("Harmony: Updated project doc",e.uuid)}else{let e=await n({file_name:o.i9,content:s});r.f("Harmony: Created project doc",e.uuid)}}async function w(e,t,n){let r=e.find(e=>e.file_name===t);r&&await n({docUuid:r.uuid})}async function b(e,t,n,r){let{projectUuid:a,directoryUuid:i}=(0,d.Xp)(r),o=(0,d.wq)(e,a,i);for(let e of(await (0,s.y3)(i),t.filter(e=>_(e,o))))await n({docUuid:e.uuid});return e.filter(e=>e!==o)}function _(e,t){if(!(0,d.Wx)(e.file_name))return!1;let{projectUuid:n,directoryUuid:r}=(0,d.Xp)(t.uri),{projectUuid:a,directoryUuid:i}=(0,d.Xp)(e.file_name);return n===a&&r===i}async function C(e,t,n,r,a,o,l){if(!e||t)return;let u=await (0,s.Zz)(e),c=await (0,d.C7)(u);if(!i()(n.map(e=>e.uri),c.map(e=>e.uri))){for(let e of u)e.root.descendants.some(t=>t.lastModified>e.lastUpdated)&&await (0,s.U4)({...e,lastUpdated:Date.now()});return await h(c,r,a,o,l),{updatedFiles:c}}}},52902:function(e,t,n){n.d(t,{O:function(){return w},cn:function(){return m},_I:function(){return v},wq:function(){return C},sy:function(){return E},IQ:function(){return b},zE:function(){return _},Wx:function(){return z},C7:function(){return h},Xp:function(){return k},pJ:function(){return f},cT:function(){return x},NC:function(){return p}});var r=n(5161),a=n(80762),i=n(98940);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}getCacheKey(e,t){return"".concat(e.name,"-").concat(t)}isPermissionExpired(e){return Date.now()-e>this.CACHE_DURATION}async checkPermission(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read",n=this.getCacheKey(e,t),r=this.permissionCache.get(n);if(r&&!this.isPermissionExpired(r.timestamp))return"granted"===r.state;try{if("queryPermission"in e){let r=await e.queryPermission({mode:t});if("granted"===r)return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}if("requestPermission"in e){let r=await e.requestPermission({mode:t});return"granted"===r&&this.permissionCache.set(n,{state:r,timestamp:Date.now(),mode:t}),"granted"===r}return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}catch(e){return a.v("Permission check failed:",e),!1}}constructor(){this.permissionCache=new Map,this.CACHE_DURATION=36e5}}let l=o.getInstance();async function u(e,t){return l.checkPermission(e,t)}var c=n(87376).Buffer;let s="inode/directory";async function d(e,t){let n=await e.getFile();return{handle:e,path:"".concat(t,"/").concat(n.name),lastModified:n.lastModified}}async function f(e,t){let n,a;let{directory:i,file:o}=E(e,t);if(!o)throw Error("File not found: ".concat(t));let l=await o.handle.getFile(),u=null;try{u=await (0,r.CL)(l),a=l.type||"text/plain"}catch(t){let e=await l.arrayBuffer();n=e.byteLength>1048576?"[File truncated due to size]":c.from(e).toString("base64"),a=l.type||"application/octet-stream"}return{uri:S(i,o),mimeType:a,text:u,blob:n}}async function p(e,t){if(!await u(e.handle,"readwrite"))throw Error("Permission denied");let n=await e.handle.getFile();try{await (0,r.CL)(n)}catch(e){throw Error("Cannot write to non-text files")}let i=await e.handle.createWritable();try{await i.write(t)}finally{await i.close()}a.f("Harmony: Wrote file ".concat(e.path," to local file system")),e.lastModified=Date.now()}async function y(e,t){try{return await e.getDirectoryHandle(t,{create:!0})}catch(e){throw Error("Failed to create directory ".concat(t))}}async function g(e,t){let n=e;for(let e=0;e<t.length-1;e++)n=await y(n,t[e]);return n}async function m(e,t,n){let{pathComponents:r}=F(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied");let a=await g(e.root.handle,r),i=r[r.length-1];try{let t={handle:await a.getFileHandle(i,{create:!0}),path:"".concat(e.root.name,"/").concat(r.join("/")),lastModified:Date.now()};return await p(t,n),e.root.descendants.push(t),!0}catch(e){throw Error("Failed to create file ".concat(t," - ").concat(e))}}async function v(e,t){let{pathComponents:n}=F(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied to delete file in the directory");let r=await g(e.root.handle,n),a=n[n.length-1];try{return await r.removeEntry(a),e.root.descendants=e.root.descendants.filter(t=>t.path!=="".concat(e.root.name,"/").concat(n.join("/"))),!0}catch(e){throw Error("Failed to delete file ".concat(a))}}async function h(e){return(await Promise.all(e.map(w))).flat()}async function w(e){try{if(await u(e.root.handle,"read")){let t=await j(e);t&&(e.root=t.updatedDirectoryRoot)}}catch(t){a.v("Harmony: Could not resync ".concat(e.uuid),t)}let t=e.root.descendants.map(t=>({uri:S(e,t)}));return t.unshift({uri:x(e),mimeType:s}),t}function b(e){return e.mimeType===s}function _(e){return!b(e)}function C(e,t,n){let r=e.find(e=>e.projectUuid===t&&e.uuid===n);if(!r)throw Error("Resource not found: ".concat(t,"/").concat(n));return r}function E(e,t){let{projectUuid:n,directoryUuid:r,pathComponents:a}=k(t),i=C(e,n,r);try{let e=function(e,t){let n="".concat(e.root.name,"/").concat(t.join("/")),r=e.root.descendants.find(e=>e.path===n);if(!r)throw Error("File not found: ".concat(n));return r}(i,a);return{directory:i,file:e}}catch(e){return{directory:i,file:null}}}function S(e,t){let n=t.path.split("/").map(encodeURIComponent);return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/")+n.join("/")}function x(e){return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/").concat(encodeURIComponent(e.root.name),"/")}async function U(e,t,n,r){let a=n.flatMap(e=>{if(""===(e=e.trim())||e.startsWith("#"))return[];let t=e.startsWith("!");return t&&(e=e.slice(1)),(e=e.replace(/^\//,"")).endsWith("/")&&(e+="*"),t?["!".concat(e)]:[e]}),o=[],l=[[e,t]],u=e=>{let t=a.filter(e=>!e.startsWith("!")).some(t=>(0,i.s7)(e,t,{dot:!0,matchBase:!0})),n=a.filter(e=>e.startsWith("!")).some(t=>(0,i.s7)(e,t.slice(1),{dot:!0,matchBase:!0}));return t&&!n};for(;l.length>0;){let[e,n]=l.shift();for await(let a of e.values()){if(o.length>=r)throw Error("Maximum number of files (".concat(r,") exceeded"));if(a.name.startsWith(".")&&".gitignore"!==a.name)continue;let e="".concat(n,"/").concat(a.name);if(!u(e.slice(t.length+1))){if("file"===a.kind){let e=await d(a,n);o.push(e)}else l.push([a,e])}}}return o}async function I(e){try{let t=await e.getFileHandle(".gitignore",{create:!1}),n=await t.getFile();return(await n.text()).split("\n").filter(e=>""!==e.trim()&&!e.startsWith("#"))}catch(e){return[]}}async function A(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500;try{let r=[...await I(e),...t],a=await U(e,e.name,r,n);return{handle:e,name:e.name,descendants:a}}catch(e){if(e instanceof Error&&e.message.includes("Maximum number of files"))throw Error("The size of this directory may cause performance degradation. Please choose a smaller directory.");throw e}}async function j(e){let t;let n=e.root;try{t=await A(e.root.handle,e.ignorePatterns)}catch(e){return null}let r=T(n.descendants),a=T(t.descendants),i=[];for(let[e,t]of r.entries()){let n=a.get(e);if(void 0===n){i.push({type:"removed",file:t});continue}n.lastModified!==t.lastModified&&i.push({type:"modified",file:n}),a.delete(e)}for(let e of a.values())i.push({type:"added",file:e});return{updatedDirectoryRoot:t,fileChanges:i}}function T(e){let t=new Map;for(let n of e)t.set(n.path,n);return t}let P=new Map,D=(e,t)=>{P.size>=1e3&&Array.from(P.keys()).slice(0,Math.floor(200)).forEach(e=>P.delete(e)),P.set(e,t)};function k(e){if(P.has(e))return P.get(e);if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');let t=new URL(e),n=t.host,[r,a,i,...o]=t.pathname.split("/").map(decodeURIComponent);if(!(n&&o.length))throw Error("Invalid URI: Missing required components");let l={projectUuid:n,directoryUuid:a,directoryName:i,pathComponents:o};return D(e,l),l}function z(e){try{return k(e),!0}catch(e){return!1}}function F(e){if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[r,a,i,...o]=t.pathname.split("/").map(decodeURIComponent);if(!n||!a||!i)throw Error("Invalid URI: Missing required components");return{projectUuid:n,directoryUuid:a,directoryName:i,pathComponents:o}}catch(e){throw Error("Invalid URI: ".concat(e.message))}}},26525:function(e,t,n){n.d(t,{Ch:function(){return P},H0:function(){return H},Qe:function(){return A},Vn:function(){return K},kR:function(){return R},kS:function(){return k}});var r=n(41596),a=n(27573),i=n(5161),o=n(71817),l=n(76220),u=n(3053),c=n(5362),s=n(27218),d=n(27895),f=n(9788),p=n(32737),y=n(30947),g=n(6385),m=n(13262),v=n(87033),h=n(35807),w=n(42755),b=n(45144),_=n(77930),C=n(7653),E=n(45790),S=n(40950),x=n(41496),U=n(1804);function I(){let e=(0,r._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-styrene\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return I=function(){return e},e}let A=20,j=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},T=e=>e.replace(/\0/g,""),P=e=>{e.extracted_content=T(e.extracted_content),e.file_name=T(e.file_name),e.file_type=T(e.file_type)},D=(e,t)=>({file_name:j(e),file_type:e.type,file_size:e.size,extracted_content:t});function k(e){let{syncSourceCount:t,files:n,setFiles:r,numExistingConversationFiles:u,attachments:c,setAttachments:s,numExistingConversationAttachments:f,detectSameAttachment:y,selectedModel:g,blobFileUploadsEnabled:m,customFileUploadHandler:v}=e,{addError:b}=(0,d.e)(),_=(0,o.wN)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:r,existingFiles:o,numExistingConversationAttachments:u,numExistingConversationFiles:c,selectedModel:s,blobFileUploadsEnabled:d,customFileUploadHandler:f}=e,y=(0,S.Z)(),{modelConfig:g}=(0,l.Ve)(s),m=g.image_in,[v,b,_,x]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:r,existingFiles:o,numExistingConversationFiles:u,selectedModel:c,blobFileUploadsEnabled:s,customFileUploadHandler:d}=e,{modelConfig:f}=(0,l.Ve)(c),p=f.image_in,y=H()&&f.pdf_in,{isUploading:g,setIsUploading:m,handleError:v,handleUpload:h}=K({imagesEnabled:p,blobFileUploadsEnabled:s,onUploadComplete:n,rasterizePdfUploadsEnabled:y,customFileUploadHandler:d}),w=(0,C.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:l=0,showError:c=!0}=e,{attachmentUploads:d,imageUploads:f,rasterizedDocumentUploads:g,outOfContextFileUploads:m}=(0,i.Jw)(n,{imagesEnabled:p,blobFileUploadsEnabled:s,rasterizePdfUploadsEnabled:y});return l+d.length+f.length+g.length+m.length+r.length+o.length+t>A?(c&&v((0,a.jsx)(E.Z,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:A}})),!1):!(f.length+g.length+o.length+u>100)||(c&&v((0,a.jsx)(E.Z,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:100,suggestion:u<100?(0,a.jsx)(E.Z,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,a.jsx)(E.Z,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}})),!1)},[p,s,r,o,t,u,v,y]);return[g,m,w,(0,C.useCallback)(async e=>{w({newUploads:e})&&await h(e)},[h,w])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:o,existingAttachments:r,numExistingConversationFiles:c,numExistingConversationAttachments:u,selectedModel:s,blobFileUploadsEnabled:d,customFileUploadHandler:f}),U=function(e){let{handleUpload:t}=e,n=(0,C.useRef)({ready:0,total:0}),r=(0,C.useCallback)(()=>{n.current={ready:0,total:0}},[]),a=(0,C.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),i=(0,C.useCallback)((e,t)=>{let r=e.length;for(let o=0;o<r;o++){let r=e[o];r.isFile?(n.current.total+=1,r.file(e=>{t.push(e),a(t)})):r.isDirectory&&r.createReader().readEntries(e=>{i(e,t)})}},[a]);return(0,C.useCallback)(e=>{var t;e.preventDefault(),r();let n=null===(t=e.dataTransfer)||void 0===t?void 0:t.items;if(!n)return;let a=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&a.push(t)}i(a,[])},[i,r])}({handleUpload:x}),I=(0,C.useCallback)(async e=>{await x(Array.from(e))},[x]),j=(0,C.useCallback)(async e=>{let t=e.target.files;t&&await x(Array.from(t)),e.target.value=""},[x]),T=m?(0,a.jsx)(E.Z,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, 30mb each)",id:"ialBpH0eLp",values:{maxUploads:A}}):(0,a.jsx)(E.Z,{defaultMessage:"Add content ({maxUploads} max, 30mb each)\\nAccepts pdf, txt, csv, etc.",id:"70asB5brJP",values:{maxUploads:A}}),P=(0,C.useCallback)(e=>{j(e)},[j]),D=(0,C.useMemo)(()=>({type:"file",accept:(0,i.tB)({imagesEnabled:m,outOfContextFilesEnabled:d}).join(","),onChange:P,multiple:!0,"aria-label":y.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[d,m,P,y]);return[v,b,_,U,I,x,(0,a.jsx)(p.u,{className:"text-center",tooltipContent:T,children:(0,a.jsxs)(Q,{children:[(0,a.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...D}),v?(0,a.jsx)(h.U,{className:"animate-spin",size:18}):(0,a.jsx)(w.p,{size:18,weight:"light"})]})},"upload-tooltip"),D]}({syncSourceCount:t,onUploadComplete:(0,C.useCallback)(async(e,t)=>{y&&e.find(e=>y(e.extracted_content))&&b((0,a.jsx)(E.Z,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so theres no need to re-upload.",id:"Uo3qvhGn7z"})),s(t=>[...t,...e]),r(e=>[...e,...t])},[s,y,b,r]),existingAttachments:c,existingFiles:n,numExistingConversationAttachments:f,numExistingConversationFiles:u,selectedModel:null!=g?g:_,blobFileUploadsEnabled:m,customFileUploadHandler:v})}let z=async(e,t,n)=>{let r=new Image;if(r.src=URL.createObjectURL(e),await new Promise(e=>{r.onload=e,setTimeout(e,250)}),!r.width||!r.height||"image/png"!==e.type&&r.width<=t&&r.height<=n)return e;let a=r.width/r.height,i=r.width,o=r.height;r.width>t&&(o=(i=t)/a),o>n&&(i=(o=n)*a);let l=document.createElement("canvas");l.style.display="none",document.body.appendChild(l);let u=l.getContext("2d");if(!u||!u.imageSmoothingQuality)return document.body.removeChild(l),e;u.imageSmoothingQuality="high",l.width=i,l.height=o,u.drawImage(r,0,0,i,o);let c=await new Promise(e=>{l.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(l),c)?new File([c],e.name,{type:"image/webp"}):e},F=()=>{let{value:e}=(0,v.FL)("use_canvas_resize");return(0,C.useCallback)(async t=>e?await z(t,2e3,2e3):t,[e])},M=()=>{let e=O(),t=R();return async(n,r,a)=>{try{return await t(n,r,a)}catch(t){e(t,(0,i.Wr)(n)?"image":"file")}}},L=e=>{let t=O(),n=R(),r=(0,c.OJ)();return async(a,i,o)=>{let l={};try{l.file=await n(a,i,o)}catch(n){n instanceof y.Hx&&"document_too_many_pages"===n.errorCode?l.attachment=await N(r,a,i,e):t(n,"document")}return l}},R=()=>{let e=(0,c.OJ)(),t=(0,_.useQueryClient)();return async(n,r,a)=>{let i=new FormData;i.append("file",n);let o=a?"/api/organizations/".concat(r,"/projects/").concat(a,"/upload"):"/api/".concat(r,"/upload"),l=await e(o,{method:"POST",body:i}),u=await l.json();if(l.ok)return a&&t.invalidateQueries({queryKey:[m.rt,{orgUuid:r,projectUuid:a}]}),u;throw(0,y.fT)(l.status,u,"File upload failed",l.headers)}},q=async(e,t,n,r)=>{let i;let o=new FormData;o.append("file",t);try{i=await e("/api/organizations/".concat(n,"/convert_document"),{method:"POST",body:o})}catch(e){return(0,b.Tb)(e),r((0,a.jsx)(E.Z,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"}))}if(429===i.status)return r((0,a.jsx)(E.Z,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"}));if(413===i.status)return r((0,a.jsx)(E.Z,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"}));if(!i.ok)return r((0,a.jsx)(E.Z,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}));let l=await i.json();return l&&0!==Object.keys(l).length&&l.extracted_content?(l.file_name=j(t),l):r((0,a.jsx)(E.Z,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}))},K=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:r,rasterizePdfUploadsEnabled:o,onUploadComplete:l,onError:f,projectUuid:p,customFileUploadHandler:y}=e,{activeOrganization:m}=(0,s.t)(),v=null!==(t=null==m?void 0:m.uuid)&&void 0!==t?t:"",[h,w]=(0,C.useState)(!1),{addError:b}=(0,d.e)(),_=(0,C.useCallback)(e=>{w(!1),b(e),f&&f()},[b,f,w]),S=F(),U=M(),I=L(_),A=(0,c.OJ)(),j=(0,u.z$)(),T=(0,C.useCallback)(async(e,t)=>{if(y){w(!0);try{let t=await y(e);t&&t.length>0&&await l([],t)}catch(e){_(e instanceof Error?e.message:"File upload failed")}finally{w(!1)}return}let{attachmentUploads:u,imageUploads:c,rasterizedDocumentUploads:s,unsupportedUploads:d,tooLargeUploads:f,outOfContextFileUploads:m}=(0,i.Jw)(e,{imagesEnabled:n,blobFileUploadsEnabled:r,rasterizePdfUploadsEnabled:o}),h=d.map(e=>(0,i.mD)(e.name));if(h.length>0)return _((0,a.jsx)(E.Z,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:h.length,formats:(0,a.jsx)(x.yX,{type:"conjunction",value:[...new Set(h)]})}}));if(f.length>0)return j.track({event_key:"file_upload_too_large",large_files:f.map(e=>({file_type:e.type,file_size:e.size}))}),_((0,a.jsx)(E.Z,{defaultMessage:"You may not upload files larger than 30mb.",id:"Gr/GvEZTX1"}));w(!0);let b=[],C=0,T=(e,n)=>{if(void 0===t)return!0;let r=new Blob([n]).size/g.r6;return!((C+=r)>t)||(_((0,a.jsx)(E.Z,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:e}})),!1)};for(let e of u){let t=await N(A,e,v,_);if(!(t&&T(e.name,t.extracted_content)))return;await l([t],[])}for(let e of c){let t=await S(e),n=await U(t,v,p);n&&b.push(n)}for(let e of s){let{file:t,attachment:n}=await I(e,v,p);if(t&&b.push(t),n){if(!T(e.name,n.extracted_content))return;await l([n],[])}}for(let e of m){let t=await U(e,v,p);t&&b.push(t)}await l([],b),w(!1)},[r,A,l,n,_,U,I,v,S,j,o,p,y]);return{isUploading:h,setIsUploading:w,handleError:_,handleUpload:T}},Q=f.q.label(I()),N=async(e,t,n,r)=>{if(!(0,i.dF)(t))try{let e=await (0,i.CL)(t);return D(t,e)}catch(e){}let a=await q(e,t,n,r);if(a)return P(a),a},O=()=>{let{addError:e}=(0,d.e)();return(0,C.useCallback)((t,n)=>{if(t instanceof y.Hx){if("rate_limit_error"===t.type){e((0,a.jsxs)("p",{children:[(0,a.jsx)(E.Z,{defaultMessage:"Youve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:n}}),(0,a.jsx)(U.o,{})]}));return}if("document_password_protected"===t.errorCode){e((0,a.jsx)("p",{children:(0,a.jsx)(E.Z,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}));return}}if(t instanceof y.Hx&&"Image is too large"===t.message){e((0,a.jsx)("p",{children:(0,a.jsx)(E.Z,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,a.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}));return}e((0,a.jsx)("p",{children:(0,a.jsx)(E.Z,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:n}})}))},[e])},H=()=>{let{value:e}=(0,v.FL)("janus_claude-ai");return e}},5161:function(e,t,n){n.d(t,{CL:function(){return A},Jw:function(){return x},Wr:function(){return C},dF:function(){return U},eh:function(){return j},mD:function(){return b},tB:function(){return v},wI:function(){return s}});var r=n(27218),a=n(1812),i=n(87033),o=n(18916);let l=[".DS_Store"],u=["jpg","jpeg","png","gif","webp"],c=["image/jpeg","image/png","image/gif","image/webp"],s={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip"],f=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],p=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],y=["docx","rtf","epub","odt","odp","pdf"],g=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],m=["csv"],v=e=>{let{imagesEnabled:t=!1,outOfContextFilesEnabled:n=!1}=e;return[".pdf",".doc",".docx",".rtf",".epub",".odt",".odp",".pptx",...w(),...t?h():[],...n?f.map(e=>".".concat(e)):[]]},h=()=>u.map(e=>".".concat(e)),w=()=>p.map(e=>".".concat(e)),b=e=>e.split(".").pop().toLowerCase(),_=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:r=!1}=t,a=b(e.name);return!!(!n&&(u.includes(a)||c.includes(e.type)))||(r?d.includes(a):[...d,...f].includes(a))},C=e=>{let t=b(e.name);return u.includes(t)||c.includes(e.type)},E=e=>[...m,...f].includes(b(e.name)),S=e=>!!l.includes(e.name),x=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:r=!1,rasterizePdfUploadsEnabled:a}=t,i=[],o=[],l=[],u=[],c=[],s=[];return e.filter(e=>!S(e)).forEach(e=>{let t=n&&C(e);_(e,{imagesEnabled:n,blobFileUploadsEnabled:r})?c.push(e):e.size>3e7?s.push(e):r&&E(e)?l.push(e):a&&("pdf"===b(e.name)||"application/pdf"===e.type)?u.push(e):U(e)?i.push(e):t?o.push(e):i.push(e)}),{attachmentUploads:i,imageUploads:o,rasterizedDocumentUploads:u,unsupportedUploads:c,tooLargeUploads:s,outOfContextFileUploads:l}},U=e=>{let t=b(e.name);return y.includes(t)||g.includes(e.type)},I=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,r=Math.min(t.length-1,1e3);for(let e=0;e<r;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let a=!0,i=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127){if(i=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){a=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){a=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){a=!1;break}e+=3}else{a=!1;break}}}if(a&&i)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let r=e[n];r<32?t.control++:r<127?t.ascii++:r>127&&(t.nonAscii++,(r>=192&&r<=255||r>=168&&r<=183)&&t.cyrillic++,(r>=128&&r<=159||r>=160&&r<=255)&&t.latin1++)}return t})(t),l=o.cyrillic/o.total*100,u=o.latin1/o.total*100,c=o.ascii/o.total*100;if(o.nonAscii>0){if(l>.3)return"windows-1251";if(u>o.control/o.total*100)return"windows-1252"}return c>90&&o.control/o.total<.1?"ascii":"utf-8"},A=async e=>{let t=await e.arrayBuffer(),n=I(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function j(){var e;let{value:t}=(0,i.FL)("ooc_attachments"),{account:n}=(0,r.t)(),l=(0,a.T)(),u=null!==(e=null!=l?l:null==n?void 0:n.settings)&&void 0!==e?e:{},{value:c}=(0,o.h)(u);return!!t&&c}},64295:function(e,t,n){function r(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("","")}:e.content?{...e,content:e.content.map(r)}:e}n.d(t,{A5:function(){return a},_B:function(){return r}});let a=e=>{let t="",n=0,r=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)r(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)r(t);t+="\n"}else if("text"===e.type){let n=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?n="**".concat(n,"**"):"italic"===t.type?n="*".concat(n,"*"):"underline"===t.type?n="__".concat(n,"__"):"strike"===t.type?n="~~".concat(n,"~~"):"code"===t.type&&(n="`".concat(n,"`"));t+=n}else if("codeBlock"===e.type){let n=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(n,"\n"),e.content)for(let t of e.content)r(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)r(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)r(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let o="   ".repeat(n);for(let l of(i?t+="".concat(o).concat(a,". "):t+="".concat(o,"* "),e.content))n+=1,r(l),n-=1}};return r(e),t.replace("","").trim()}},18916:function(e,t,n){n.d(t,{h:function(){return i}});var r=n(87033),a=n(58183);function i(e){let t=(0,a.useLayer)("frontend").get("analysis_tool_experiment_enabled",!1),{value:n}=(0,r.FL)("rely_on_analysis_flag"),{value:i}=(0,r.FL)("analysis_tool_launch_ga");if(n){var o;return{value:null!==(o=null==e?void 0:e.enabled_artifacts_attachments)&&void 0!==o?o:i,source:"flag"}}return{value:(null==e?void 0:e.enabled_artifacts_attachments)||t,source:"experiment"}}},76220:function(e,t,n){n.d(t,{E6:function(){return y},Ve:function(){return s},uL:function(){return p}});var r=n(5362),a=n(27218),i=n(13262),o=n(87033),l=n(98649),u=n(41270);let c={image_in:!0,pdf_in:!1},s=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,{data:o,isLoading:l,isPlaceholderData:u}=(0,r.WE)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[i.Qn,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}});return{isLoading:l,modelConfig:!u&&o||c}},d=u.z.array(u.z.object({model:u.z.string(),name:u.z.string(),description:u.z.string().optional(),description_i18n_key:u.z.string().optional(),notice_text:u.z.string().optional(),notice_text_i18n_key:u.z.string().optional(),inactive:u.z.boolean().optional(),overflow:u.z.boolean().optional(),knowledgeCutoff:u.z.string().optional(),slow_kb_warning_threshold:u.z.number().optional(),paprika_modes:u.z.array(l.Xs).optional(),capabilities:u.z.object({mm_pdf:u.z.boolean().optional(),mm_images:u.z.boolean().optional(),web_search:u.z.boolean().optional(),gsuite_tools:u.z.boolean().optional(),compass:u.z.boolean().optional()}).optional()})),f=[],p=()=>{let e=(0,o.Zr)("claude_ai_models","models",f,d),t=e.filter(e=>!e.inactive),n=t.filter(e=>!e.overflow),r=t.filter(e=>e.overflow);return{allModelOptions:e,activeModelOptions:t,mainModels:n,overflowModels:r}},y=()=>{let{allModelOptions:e}=p();return(t,n)=>{let r=e.find(e=>e.model===t);if(!r)return!1;let a=null==r?void 0:r.capabilities;return!a||!1!==a[n]}}},6766:function(e,t,n){n.d(t,{M:function(){return u}});var r=n(87033),a=n(5068),i=n(7653),o=n(71817),l=n(76220);let u=()=>{let e="sticky-model-selector",{value:t}=(0,r.FL)("sticky_model_selector"),{value:n}=(0,r.FL)("model_selector_enabled"),{activeModelOptions:u}=(0,l.uL)(),c=(0,o.wN)(null),s=(0,a.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===c?null:r&&u.find(e=>e.model===r)?r:null},initialData:null}),d=(0,i.useCallback)(t=>{t&&localStorage.setItem(e,t),s.refetch()},[s]);return{stickyModelPreference:s.data,setStickyModelPreference:d}}},80762:function(e,t,n){function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}n.d(t,{f:function(){return r},v:function(){return a}})},70773:function(e,t,n){function r(e){let t=e,n="",r=0;for(;t!==n&&r<10;)n=t,t=(t=(t=(t=t.normalize("NFKC")).replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"")).replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")).replace(/[\u200B-\u200F]/g,"").replace(/[\u202A-\u202E]/g,"").replace(/[\u2066-\u2069]/g,"").replace(/[\uFEFF]/g,"").replace(/[\uE000-\uF8FF]/g,""),r++;if(r>=10)throw Error("Unicode sanitization reached maximum iterations (".concat(10,") for input: ").concat(e.slice(0,100)));return t}n.d(t,{G:function(){return r},Q:function(){return function e(t){if("string"==typeof t)return r(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let n={};for(let[r,a]of Object.entries(t))n[e(r)]=e(a);return n}return t}}})},10228:function(e,t,n){var r,a,i,o;n.d(t,{Fg:function(){return r},co:function(){return a},hP:function(){return l},qC:function(){return u}}),(i=r||(r={})).GITHUB="github",i.GDRIVE="gdrive",i.OUTLINE="outlin",i.SALESFORCE="sfdc",i.GMAIL="gmail",i.GCAL="gcal",i.SLACK="slack",i.ASANA="asana",i.FIDDLEHEAD="fiddlehead";let l={github:"GitHub",gdrive:"Google Drive",outlin:"Outline",sfdc:"Salesforce",gmail:"Gmail",gcal:"Google Calendar",slack:"Slack",asana:"Asana",fiddlehead:"Fiddlehead"};(o=a||(a={})).CREATED="created",o.PENDING="pending",o.FAILED="failed",o.UPDATING="updating",o.UPDATE_FAILED="update_failed",o.READY="ready",o.UNAUTHENTICATED="unauthenticated",o.ACCESS_DENIED="access_denied",o.DISABLED="disabled";let u=["access_denied","failed","unauthenticated","update_failed"]}}]);